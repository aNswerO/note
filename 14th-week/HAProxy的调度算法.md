# HAProxy的调度算法：
>balabce：指明对后端服务器的调度算法，配置在listen或backend设置块中
## 静态调度算法：
>按照实现定义好的规则轮询公平调度，不关心后端服务器的当前负载、链接数和速度等，且无法实时修改权重，只能在重启后才能使权重的修改生效
+ static-rr：基于权重的轮询调度，不支持运行时修改权重及后端服务器慢启动（即新加的服务器会逐渐增加转发数），其后端主机数量没有限制

+ first：根据服务器在列表中的位置，自上而下进行调度，但是其只会当第一台服务器的连接数达到上限时，才会将心情求分配给下一台服务器；因此此算法会忽视服务器的权重设置
## 动态调度算法：
>基于后端服务器的状态进行调度的适当调整，比如优先调度至当前负载较低的服务器，且权重可以在HAProxy运行时动态调整而无需重启
+ roundrobin：基于权重的轮询动态调度算法，支持在运行时调整权重，不等于lvs的rr；支持慢启动，每个backend中最多支持4095个server；此为默认调度算法

+ leastconn：加权的最少连接动态调度算法，支持在运行时调整权重和慢启动；当前后端服务器连接最少的优先调度，比较适合长连接的场景使用，如MySQL等场景

## 以下调度算法的动静态取决于其hash-type是否为consistent：
+ source：源地址hash，基于用户源地址hash并将请求转发到后端服务器，默认为静态取模方式，但可以通过hash-type支持的选项更改，后续同一源地址的请求将被转发至同一个后端web服务器，比较适用于session保持/缓存业务等场景
    + hash-type：
        + map-based：取模法，基于服务器权重的hash数组取模；该hash是静态的即不支持在线调整权重和慢启动，其对后端的服务器调度均衡，缺点是当后端服务器的总权重发生变化（即有服务器上线或下线）时，都会因权重发生变化而导致调度结果整体发生改变

        + consistent：一致性hash，该hash为动态的，支持在线调整权重和慢启动；优点是当后端服务器的总权重发生变化时，对调度结果的影响是局部的，不会引起大的变动

+ uri：对URI的前部分（“?”标记之前的部分）或整个URI进行hash运算，并由后端服务器的总权重相除后转发给匹配的服务器；这样会将同一个URI的请求总是被转发至同一个服务器，除非后端服务器的总权重发生了变化；此算法适用于代理缓存或反病毒代理以提高缓存的命中率；默认为静态算法，但可以将hash-type修改为consistent成为动态算法
    >此算法仅应用于HTTP后端服务器场景
+ url_param：对用户请求中的URL中的\<pamrams>部分的参数的**name**作hash运算，b并由服务器总权重相除以后转发到挑选出的服务器；通常用于追踪用户，以确保来自同一用户的请求始终发往同一个Backend Server
+ hdr：针对用户每个http头部请求中的指定信息作hash，此处由\<name>指定的http首部（如User-Agent，区分大小写）将会被取出并做hash运算，然后由服务器总权重相除以后转发至选出的服务器，假如没有有效的值，则会被轮询调度
+ rpd-cookie：对远程桌面的负载，使用cookie保持会话