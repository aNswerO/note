# NAT模式：
+ 原理：通过网络地址转换实现调度
    ```
        首先，VS（调度器）收到客户端的请求数据包时（客户端请求的IP为VIP），根据调度算法决定将请求发送给哪个后端的RS（真实服务器）  
        然后VS就把客户端发送的请求报文中的目标IP地址和目标端口改为后端真实服务器的IP（RIP）
        RS（真实服务器）响应玩请求时后，查看默认路由（NAT模式下RS的默认路由指向VS的DIP，所以NAT模式下响应报文会经由VS）  
        VS收到响应报文后，将源地址改为VIP后发送给客户端
    ```
+ 优点：
    + 只需一个公网IP地址（配置在VS上）

    + NAT模式支持对IP地址和端口进行转换，即用户请求的端口可以和真实服务器的端口不一致
+ 缺点：
    + 由于每个请求和响应报文都需要VS进行改写，所以在访问量过大时，VS的压力会很大

# DR模式：
+ 原理：通过改写请求报文的目标MAC地址实现调度
    ```
        在DR模式中，调度器根据算法调度真实服务器，不修改目标IP和port，而是将报文的数据帧的目标MAC地址改为真实服务器的MAC地址，然后再局域网内发送给真实服务器  
        真实服务器收到请求数据包后，解开IP首部发现目标IP是VIP（自己就有VIP）  
        然后真实服务器将响应报文发送给路由器，而不是发送给VS，由路由器将响应报文发送给客户端
    ```
+ 优点：
    + 请求报文经过VS，而响应报文不经过；相比NAT模式，高并发下效率更高

+ 缺点：
    + 由于只对MAC地址进行了修改，所以不支持端口转换，RS必须使用和VS相同的端口提供服务

# TUN模式：
+ 原理：VS把请求报文通过**IP隧道**转发到真实的服务器，真实的服务器将响应处理后的数据直接返回给客户端
    ```
        客户端发送请求数据包到VS上  
        VS收到请求数据包后进行IP tunnel封装（即在原有的包头加上IP tunnel的包头），然后发送给被调度的RS  
        RS通过逻辑隧道（只有VS和RS进行通信）收到请求包，然后解开IP tunnel包头得到用户的请求包并进行响应处理  
        响应处理完成后，RS通过公网线路将响应数据包发送给客户端
    ```

+ 优点：
    + VS只负责将请求包发送给RS，而响应包则由RS直接发送给用户；减少了VS的数据流动

    + 在公网上就能进行不同地域的分发
+ 缺点：
    + 每个RS都需要公网IP，成本高

    + 需要所有的服务器都支持“IP tunnel”协议，服务器只能局限于部分Linux系统上

# FULLNAT模式：
+ 原理：与NAT模式一样，请求报文和响应报文都经过VS，但引入了一个LIP（Local IP：内网IP）；同时修改请求报文中的源和目标IP地址进行转发，即CIP --> VIP，LIP --> RIP

+ 优点：
    + 支持端口映射

    + 部署成本低
+ 缺点：
    + 内核默认不支持
    
    + RS无法获得用户IP