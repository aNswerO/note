
# 计算机网络
## 广域网（WAN）
```
    连接不同地区的局域网或城域网计算机通信的远程网
```
## 局域网（LAN）
```
    在一个局部的地理范围内，由多台计算机、外部设备和数据库互联组成的计算机通信网
```
## 网络节点间的通信方式：
+ 单播（Unicast）：两主机之间的点对点通信方式
+ 广播（broadcast）：主机间“一对所有”的通信方式
+ 组播（Multicast）：主机间“一对一组”的通信方式
### 冲突域：
+ 指单播（发送给指定的、传输路线明确的主机）时影响的范围，多个bit流在同一介质上同时传输所产生的冲突
### 广播域：
+ 发送给一个尚不明确的目标时影响的范围
# OSI（开放系统互联）模型：
>**PDU**（协议数据单元）：指对等层级之间传递的数据单位
## OSI模型下层：
>处理数据在网络介质中的传输
+ 物理层（physical layer）：为上层协议提供传输数据的物理媒体，并确保数据能在各种物理媒体上传输
    + 本层的**PDU**为**数据位**（bit）
    + 工作在本层的设备：集线器、中继器

+ 数据链路层（data link layer）：进行物理寻址，通过Mac地址负责主机间数据的可靠传输；并将数据（bit流）封装成帧；还能进行流量控制，数据检错与重发
    + 本层的**PDU**为**帧**（frame）
    + 工作在本层的设备：交换机、网卡、网桥
        + 交换机、网桥用来分隔冲突域

+ 网络层（network layer）：对子网间的数据传输选择最佳路线，完成主机间的数据传输；还能实现拥塞控制、网际互联等功能
    + 本层**PDU**为**数据包**（packet）
    + 工作在本层的设备：路由器
        + 路由器用来分隔广播域
    + 本层的主要协议：
        + IP（Internet协议）
        + ICMP（Internet控制报文协议）
        + ARP（地址解析协议）

+ 传输层（transport layer）：定义传输数据的协议端口号，确保两个主机进程间数据传输的可靠性；本层向会话层提供独立于网络层的传送服务和可靠的透明数据传输
    + 本层**PDU**为**数据段**（segment）
    + 本层中的主要协议：
        + TCP（传输控制协议）
        + UDP（用户数据包协议）

## OSI模型上层：
>处理用户接口、数据格式和应用访问；OSI上层的**PDU**均为**消息**（message）
+ 会话层：主要功能是在两个节点间建立、维护和释放面向用户的链接，并对会话进行管理和控制，保证会话数据可靠传送
+ 表示层：主要负责数据格式的转换，如压缩和解压、加密与解密
+ 应用层：为用户提供常用的应用程序
## TCP协议：
### TCP包头：
+ 源端口、目标端口：
    + 主机间的通信实际是端口之间的通信，而一个主机的端口同一时间只能被一个**进程**占用。所以只要指定源端口和目标端口，就能得知是哪两个端口进行通信。
    + 由于端口是16位表示的，所以主机的端口个数为**2^16-1=65535**个（0~65535）
+ （seq）序列号：
    + 表示本报文段所发送的第一个字节的编号
    + TCP连接中所传送的字节流的每一个字节都按顺序编号
    + 由于序列号用32位表示，所以每传输2^32个字节，就会出现序列号回绕，重新从0开始
+ (ack)确认号：
    + 表示接受方期望收到发送端下一个报文段的第一个字节数据的序列号，即**seq+1**
+ 数据偏移：
    + 表示TCP报文段的首部长度，共4位
    + 由于TCP首部包含一个长度可变的选项部分，需要指定这个TCP报文段有多长
    + 它指出TCP报文段的**数据起始处**距离TCP报文段的起始处有多远
+ URG（紧急指针位）：
    + 表示本报文段中发送的数据是否包含紧急数据
    + 后面的紧急指针字段只有在URG=1时才会生效
+ SYN（同步位）：
    + 建立连接时使用，用来同步序号
    + 只有在三次握手的前两次握手阶段SYN才置1，SYN置1的报文段被称为同步报文段
    + 当SYN=1、ACK=0时，表示这是一个请求建立连接的报文段
    + 当SYN=1、ACK=1时，表示对方已同意建立连接
    + 当SYN=0、ACK=1时，表示这是一个请求建立连接或同意建立连接的报文段
+ ACK（确认位）：
    + 表示前面的ack（确认号）是否有效
    + 当ACK置1时，确认号生效
    + TCP规定，连接建立后，ACK必须置1，这些报文段被称为确认报文段
+ PSH：
    + 提示接收端进程立即从TCP接受缓存区中读走数据，为接受后续数据腾出空间
    + 如果进程不将数据读走，数据会一直停留在TCP接收缓冲区中
+ RST：
    + 如果收到一个RST置1的报文，说明与主机的连接出现了严重错误，必须释放连接，再重新建立连接
    + RST置1的TCP报文段被称为复位报文段
+ FIN：
    + 表示通知对方本端要关闭连接了，标记数据是否发送完毕
    + FIN置1为提示对方数据已发送完毕，对方可以释放连接了，此类TCP报文段被称为结束报文段
+ 窗口大小：
    + 表示现在允许对方发送的数据量，即本报文段的确认号开始允许对方发送的数据量，达到此值需要ACK确认才能继续传送后面的数据
+ 校验和：
    + 提供额外的可靠性
+ 紧急指针：标记紧急数据在数据段中的位置
## TCP三次握手：
+ 第一次握手：客户端向服务器发起连接请求，发送报文段，此报文段SYN置1，ACK置0，seq为x；然后客户端进入SYN_SENT(同步发送)状态

+ 第二次握手：服务器收到报文，回复报文段，此报文段中SYN置1，ACK置1，seq=x，ack=x+1，表示要客户端发送seq=x+1的数据包；然后服务器进入SYN_WAIT（同步等待）状态

+ 第三次握手：客户端收到报文，将报文段中的SYN置0，ACK置1，并发送seq=x+1的数据包；然后客户端进入ESTABLISHED（建立连接）状态；服务端收到此报文后同样进入ESTABLISHED(建立连接)状态
## TCP四次断开：
+ 第一次：客户端发送报文，FIN置1，seq=u，然后进入FIN-WAIT-1（终止等待-2）状态，等待服务器确认

+ 第二次：服务器收到报文，ACK置1，seq=u+1=v，ack=u+1，发送剩余的未传输完的数据包，并进入CLOSE-WAIT（等待关闭）状态；此时客户端收到此报文和数据包，进入FIN-WAIT-2（终止等待-2）状态

+ 第三次：服务器将最后的数据包发送完毕，再发送一个报文，此报文中FIN置1，ACK置1，seq=v+1=w，ack=u+1，然后进入LAST-ACK（最后确认）状态

+ 第四次：客户端收到报文，发送确认报文，ACK仍然置1，seq=u+1，ack=w+1，然后进入TIME-WAIT（等待）状态（在此状态等待2MSL）；此时服务器接受到该报文，进入CLOSE（关闭）状态；由于服务器进入CLOSE状态，客户端不会收到回应报文，在等待时长超过2MSL后，客户端也进入CLOSE状态，本次连接结束

