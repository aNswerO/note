# 数据的实时同步：
+ 实现实时同步的思路：
    1. 利用监控服务（**inotify**），监控同步数据服务器目录中信息的变化

    2. 一旦发现目录中数据发生变化，就利用**rsync**服务推送到备份服务器上

    3. 组合使用**inotify**和**rsync**：
        + inotify：负责对同步数据目录信息的监控

        + rsync：负责完成数据的同步
        + 利用脚本将二者结合
## inotify：
>异步的文件系统监控机制；  
利用事件驱动机制，无需通过cron的轮询机制来获取事件；  
通过inotify可以监控文件系统中添加、删除、修改、移动等事件
+ 内核参数：
    + max_queued_events：inotify事件队列最大长度，若值太小会出现**Event Queue Overflow**的错误；默认值为16384

    + max_user_watches：可以监视的文件数量（单进程）；默认值为8192
    + max_user_instances：每个用户创建inotify实例的最大值；默认值为128
+ 安装（基于epel源）：
    ```
    yum install -y inotify-tools
    ```
+ inotify-tools包主要文件：
    + inotifywait：在被监控的文件或目录上等待特定文件系统事件（open、close、delete）发生，常用语实时同步的目录监控

    + inotifywatch：收集被监控的文件系统使用的统计数据，指文件系统时间发生的次数统计
+ inotifywait命令的常见选项：
    ```sh
    -m,--monitor    #始终保持事件监听
    -d,--daemon    #以守护进程方式执行，与-m相似，常配合-o使用
    -r,--recursive    #递归监测目录数据信息变化
    -q.--quiet    #输出少量事件信息
    --exclude <PATTERN>    #指定排除文件或目录，使用扩展正则表达式匹配的模式
    -o,--outfile <FILE>    #打印事件到文件中，相当于标准正确输出
    -s,--syslogOutput    #发送错误到syslog，相当于标准错误输出
    --timefmt <FMT>    #指定时间输出格式
        %Y    #年份信息，包括世纪信息
        %y    #年份信息，不包括世纪信息
        %m    #显示月份；范围01~12
        %d    #显示每月的第几天；范围01~31
        %H    #小时，使用24进制；范围00~23
        %M    #分钟；范围00~59
    --format <FMT>    #指定的输出格式；即实际监控输出内容
        %T    #输出时间格式中定义的时间格式信息，通过--timefmt option语法格式指定时间信息
        %w    #事件出现时，监控文件或目录的名称信息
        %f    #事件出现时，将显示监控目录下触发事件的文件或目录信息，否则为空
        %e    #显示发生的事件信息，不同的事件默认用逗号分隔
        %Xe    #显示发生的事件信息，不同的事件指定用X进行分隔
    -e    #指定监听指定的事件；若省略，表示所有事件都监听
        create    #文件或目录创建
        delete    #文件或目录被删除
        modify    #文件或目录内容被写入
        attrib    #文件或目录属性改变
        close_write    #文件或目录关闭；在写入模式打开之后关闭的
        close_mowrite    #文件或目录关闭；在只读模式打开后关闭的
        close    #文件或目录关闭；不管是读还是写模式
        open    #文件或目录被打开
        moved_to    #文件或目录被移动到监控的目录中
        moved_from    #文件或目录从被监控的目录中被移动
        move    #文件或目录不管移动到或是移动出被监控目录都触发事件
        access    #文件或目录内容被读取
        delete_self    #文件或目录；目录本身被删除
        unmount    #取消挂载
    ```
